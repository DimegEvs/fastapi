{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block content %}
<div class="flex justify-center flex-col items-center">
    <div class="flex my-3 gap-5">
        <input id="user_search" type="text" placeholder="Поиск" class="text-xl">
        <button id="search_button" class="border-2 rounded-3xl bg-gray-300 p-3">Поиск по юзерам</button>
    </div>
    <div id="users_container"></div>

    <script>
        const createUserElement = (user) => {
            const userElement = document.createElement("div");
            userElement.classList.add("flex", "rounded-3", "border-2", "p-3", "mt-5");
            userElement.innerHTML = `
                <div class="flex justify-center flex-col items-center">
                    <span class="text-2xl font-bold">${user.name}</span>
                    <span class="text-lg">${user.surname}</span>
                    <span class="text-lg">${user.email}</span>
                </div>
            `;
            return userElement;
        };

        const searchForUser = async () => {
            const searchInputValue = document.getElementById("user_search").value;
            const usersContainer = document.getElementById("users_container");

            // Очистка контейнера с пользователями перед новым поиском
            usersContainer.innerHTML = "";

            try {
                // AJAX запрос на сервер
                const response = await fetch(`/user/get-all?data=${encodeURIComponent(searchInputValue)}`);
                const user_data = await response.json();
                console.log(user_data)
                user_data.forEach(user => {
                    const userElement = createUserElement(user);
                    usersContainer.appendChild(userElement);
                });
            } catch (error) {
                console.error('Ошибка:', error);
            }
        };

        // Обработчик клика по кнопке "Поиск по юзерам"
        document.getElementById("search_button").addEventListener("click", searchForUser);

        // Обработчик события клавиш для поля ввода
        document.getElementById("user_search").addEventListener("keypress", (event) => {
            if (event.key === 'Enter') {
                searchForUser();
            }
        });
    </script>
</div>
{% endblock %}
